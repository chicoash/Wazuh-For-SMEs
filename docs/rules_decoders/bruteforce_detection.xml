<!--
Rule IDs from 110010 - 110032
and 110050
-->

<group name="local,auth,bruteforce,">

  <!-- ===================== WINDOWS (Security log) ===================== -->
  <!-- Base: Failed logon -->
  <rule id="110010" level="5">
    <if_group>windows,windows_security</if_group>
    <field name="win.system.eventID">^4625$</field>
    <description>Windows: Failed logon - $(win.eventdata.TargetUserName) from $(win.eventdata.IpAddress)</description>
    <options>no_full_log</options>
    <group>windows,auth_failed,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <!-- By user -->
  <rule id="110011" level="10" frequency="5" timeframe="120">
    <if_matched_sid>110010</if_matched_sid>
    <same_field>win.eventdata.TargetUserName</same_field>
    <description>Windows: Possible brute force against $(win.eventdata.TargetUserName) (>=5 fails/2m)</description>
    <group>windows,bruteforce,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <!-- By source IP -->
  <rule id="110012" level="10" frequency="8" timeframe="120">
    <if_matched_sid>110010</if_matched_sid>
    <same_field>win.eventdata.IpAddress</same_field>
    <description>Windows: Possible brute force from $(win.eventdata.IpAddress) (>=8 fails/2m)</description>
    <group>windows,bruteforce,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <!-- RDP-specific (LogonType 10) -->
  <rule id="110013" level="6">
    <if_group>windows,windows_security</if_group>
    <field name="win.system.eventID">^4625$</field>
    <field name="win.eventdata.LogonType">^10$</field>
    <description>Windows RDP: Failed logon - $(win.eventdata.TargetUserName) from $(win.eventdata.IpAddress)</description>
    <group>windows,rdp,auth_failed,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <rule id="110014" level="10" frequency="5" timeframe="120">
    <if_matched_sid>110013</if_matched_sid>
    <same_field>win.eventdata.TargetUserName</same_field>
    <description>Windows RDP: Possible brute force against $(win.eventdata.TargetUserName) (>=5 fails/2m)</description>
    <group>windows,rdp,bruteforce,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <rule id="110015" level="10" frequency="8" timeframe="120">
    <if_matched_sid>110013</if_matched_sid>
    <same_field>win.eventdata.IpAddress</same_field>
    <description>Windows RDP: Possible brute force from $(win.eventdata.IpAddress) (>=8 fails/2m)</description>
    <group>windows,rdp,bruteforce,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <!-- Account lockout -->
  <rule id="110050" level="12">
    <if_group>windows,windows_security</if_group>
    <field name="win.system.eventID">^4740$</field>
    <description>Windows: Account locked out - $(win.eventdata.TargetUserName)</description>
    <group>windows,account_lockout,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <!-- ===================== LINUX (SSH) ===================== -->
  <!-- Base: SSH failed password -->
  <rule id="110020" level="5">
    <if_group>sshd</if_group>
    <match>Failed password</match>
    <description>Linux SSH: Failed password for $(dstuser) from $(srcip)</description>
    <group>linux,ssh,auth_failed,</group>
    <mitre><id>T1110.001</id></mitre>
  </rule>

  <!-- Base: SSH invalid user -->
  <rule id="110021" level="5">
    <if_group>sshd</if_group>
    <match>Invalid user</match>
    <description>Linux SSH: Invalid user from $(srcip)</description>
    <group>linux,ssh,auth_failed,</group>
    <mitre><id>T1110.001</id></mitre>
  </rule>

  <!-- By user -->
  <rule id="110022" level="10" frequency="5" timeframe="120">
    <if_matched_sid>110020</if_matched_sid>
    <same_field>dstuser</same_field>
    <description>Linux SSH: Possible brute force against $(dstuser) (>=5 fails/2m)</description>
    <group>linux,ssh,bruteforce,</group>
    <mitre><id>T1110.001</id></mitre>
  </rule>

  <!-- By source IP -->
  <rule id="110023" level="10" frequency="8" timeframe="120">
    <if_matched_sid>110020</if_matched_sid>
    <same_field>srcip</same_field>
    <description>Linux SSH: Possible brute force from $(srcip) (>=8 fails/2m)</description>
    <group>linux,ssh,bruteforce,</group>
    <mitre><id>T1110.001</id></mitre>
  </rule>

  <!-- ===================== LINUX (su / PAM) ===================== -->
  <!-- Base: su auth failure via PAM (your JSON shows these fields) -->
  <rule id="110024" level="5">
    <if_group>pam</if_group>
    <match>pam_unix\(su:auth\): authentication failure</match>
    <description>Linux PAM(su): Auth failure — ruser=$(data.srcuser) -> user=$(data.dstuser) from $(data.rhost) tty=$(data.tty)</description>
    <group>linux,pam,su,auth_failed,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <!-- Counter: by TARGET user (covers common 'user=root' attempts) -->
  <rule id="110025" level="10" frequency="6" timeframe="180">
    <if_matched_sid>110024</if_matched_sid>
    <same_field>data.dstuser</same_field>
    <description>Linux PAM(su): Possible brute force against $(data.dstuser) (>=6 fails/3m)</description>
    <group>linux,pam,su,bruteforce,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <!-- Counter: by HOST (local attempts; su has no src IP) -->
  <rule id="110026" level="10" frequency="6" timeframe="180">
    <if_matched_sid>110024</if_matched_sid>
    <same_field>agent.id</same_field>
    <description>Linux PAM(su): Multiple local auth failures on $(agent.name) (>=6/3m)</description>
    <group>linux,pam,su,bruteforce,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <!-- Optional counter: by rhost if present (remote su, rare) -->
  <rule id="110028" level="10" frequency="5" timeframe="180">
    <if_matched_sid>110024</if_matched_sid>
    <field name="data.rhost">\S+</field>
    <same_field>data.rhost</same_field>
    <description>Linux PAM(su): Possible brute force from $(data.rhost) (>=5 fails/3m)</description>
    <group>linux,pam,su,bruteforce,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <!-- ===================== OFFICE 365 ===================== -->
  <rule id="110030" level="6">
    <if_group>office365</if_group>
    <field name="office365.ResultStatus">(?i)Failure|Failed|Error</field>
    <description>O365: Failed sign-in — user $(office365.UserId) from $(office365.ClientIP)</description>
    <group>o365,auth_failed,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <rule id="110031" level="10" frequency="6" timeframe="300">
    <if_matched_sid>110030</if_matched_sid>
    <same_field>office365.UserId</same_field>
    <description>O365: Possible brute force against $(office365.UserId) (>=6 fails/5m)</description>
    <group>o365,bruteforce,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

  <rule id="110032" level="10" frequency="8" timeframe="300">
    <if_matched_sid>110030</if_matched_sid>
    <same_field>office365.ClientIP</same_field>
    <description>O365: Possible brute force from $(office365.ClientIP) (>=8 fails/5m)</description>
    <group>o365,bruteforce,</group>
    <mitre><id>T1110</id></mitre>
  </rule>

</group>
